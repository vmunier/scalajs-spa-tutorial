<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Autowire and uPickle | Scala.js SPA-tutorial</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./server-side.html" />
    
    
    <link rel="prev" href="./todo-module-and-data-flow.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    <div class="book" data-level="2.1.7" data-basepath="." data-revision="Thu Apr 02 2015 22:08:03 GMT+0300 (FLE Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="getting-started.html">
            
                
                    <a href="./getting-started.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting started
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="application-structure.html">
            
                
                    <a href="./application-structure.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Application structure
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="the-client.html">
            
                
                    <a href="./the-client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        The Client
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="routing.html">
            
                
                    <a href="./routing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        Routing
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="main-menu.html">
            
                
                    <a href="./main-menu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                        Main menu
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="dashboard.html">
            
                
                    <a href="./dashboard.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                        Dashboard
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="css-in-scala.html">
            
                
                    <a href="./css-in-scala.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                        CSS in Scala
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="integrating-javascript-components.html">
            
                
                    <a href="./integrating-javascript-components.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.5.</b>
                        
                        Integrating JavaScript components
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="todo-module-and-data-flow.html">
            
                
                    <a href="./todo-module-and-data-flow.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.6.</b>
                        
                        Todo module and data flow
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="2.1.7" data-path="autowire-and-upickle.html">
            
                
                    <a href="./autowire-and-upickle.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.7.</b>
                        
                        Autowire and uPickle
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="server-side.html">
            
                
                    <a href="./server-side.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Server side
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="testing.html">
            
                
                    <a href="./testing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Testing
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="debugging.html">
            
                
                    <a href="./debugging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Debugging
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="logging.html">
            
                
                    <a href="./logging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Logging
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="sbt-build-definition.html">
            
                
                    <a href="./sbt-build-definition.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SBT build definition
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="serving-compiled-js-from-both-projects.html">
            
                
                    <a href="./serving-compiled-js-from-both-projects.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Serving compiled JS from both projects
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="sharing-web-resources-between-js-and-jvm-projects.html">
            
                
                    <a href="./sharing-web-resources-between-js-and-jvm-projects.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Sharing web resources between JS and JVM projects
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="using-resources-from-webjars.html">
            
                
                    <a href="./using-resources-from-webjars.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Using resources from WebJars
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="running-the-server-in-a-separate-jvm.html">
            
                
                    <a href="./running-the-server-in-a-separate-jvm.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Running the server in a separate JVM
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="production-build.html">
            
                
                    <a href="./production-build.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Production build
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="faq.html">
            
                
                    <a href="./faq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        FAQ
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="what-next.html">
            
                
                    <a href="./what-next.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        What next?
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">Published with GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Share on Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Share on Google</button>
                <button type="button" data-sharing="facebook" class="button">Share on Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Share on Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Share on Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Scala.js SPA-tutorial</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="autowire-and-upickle">Autowire and uPickle</h1>
<p>Web clients communicate with the server most commonly with <em>Ajax</em> which is quite loosely defined collection of techniques. Most notable
JavaScript libraries like JQuery provide higher level access to the low level protocols exposed by the browser. Scala.js provides a nice
Ajax wrapper in <code>dom.extensions.Ajax</code> (or <code>dom.ext.Ajax</code> in scalajs-dom 0.8+) but it&apos;s still quite tedious to serialize/deserialize objects
and take care of all the dirty little details.</p>
<p>But fear not, there is no need to do all that yourself as our friend <a href="https://github.com/lihaoyi" target="_blank">Li Haoyi (lihaoyi)</a> has created and
published two great libraries called <a href="https://github.com/lihaoyi/upickle" target="_blank">uPickle</a> and <a href="https://github.com/lihaoyi/autowire" target="_blank">Autowire</a>.</p>
<p>To build your own client-server communication pathway all you need to do is to define a single object on the client side and another on the
server side.</p>
<pre><code class="lang-scala"><span class="hljs-comment">// client side</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">AjaxClient</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">autowire</span>.<span class="hljs-title">Client</span>[</span><span class="hljs-type">String</span>, upickle.<span class="hljs-type">Reader</span>, upickle.<span class="hljs-type">Writer</span>]{
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">doCall</span>(</span>req: <span class="hljs-type">Request</span>): <span class="hljs-type">Future</span>[<span class="hljs-type">String</span>] = {
    dom.extensions.<span class="hljs-type">Ajax</span>.post(
      url = <span class="hljs-string">&quot;/api/&quot;</span> + req.path.mkString(<span class="hljs-string">&quot;/&quot;</span>),
      data = upickle.write(req.args)
    ).map(_.responseText)
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>[</span><span class="hljs-type">Result</span>: upickle.<span class="hljs-type">Reader</span>](p: <span class="hljs-type">String</span>) = upickle.read[<span class="hljs-type">Result</span>](p)
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>[</span><span class="hljs-type">Result</span>: upickle.<span class="hljs-type">Writer</span>](r: <span class="hljs-type">Result</span>) = upickle.write(r)
}
</code></pre>
<p>The only variable specific to your application is the URL you want to use to call the server. Otherwise everything else it automatically
generated for you through the magic of macros. The server side is even simpler, just letting Autowire know that you want to use uPickle
for serialization.</p>
<pre><code class="lang-scala"><span class="hljs-comment">// server side</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Router</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">autowire</span>.<span class="hljs-title">Server</span>[</span><span class="hljs-type">String</span>, upickle.<span class="hljs-type">Reader</span>, upickle.<span class="hljs-type">Writer</span>]{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>[</span><span class="hljs-type">Result</span>: upickle.<span class="hljs-type">Reader</span>](p: <span class="hljs-type">String</span>) = upickle.read[<span class="hljs-type">Result</span>](p)
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>[</span><span class="hljs-type">Result</span>: upickle.<span class="hljs-type">Writer</span>](r: <span class="hljs-type">Result</span>) = upickle.write(r)
}
</code></pre>
<p>Now that you have the <code>AjaxClient</code> set up, calling server is as simple as</p>
<pre><code class="lang-scala"><span class="hljs-keyword">import</span> scalajs.concurrent.<span class="hljs-type">JSExecutionContext</span>.<span class="hljs-type">Implicits</span>.runNow
<span class="hljs-keyword">import</span> autowire._

<span class="hljs-type">AjaxClient</span>[<span class="hljs-type">Api</span>].getTodos().call().foreach { todos =&gt;
  println(s<span class="hljs-string">&quot;Got some things to do $todos&quot;</span>)
}
</code></pre>
<p>Note that you need those two imports to access the Autowire magic and to provide an execution context for the futures.</p>
<p>The <code>Api</code> is just a simple trait shared between the client and server.</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Api</span> {</span>
  <span class="hljs-comment">// message of the day</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">motd</span>(</span>name:<span class="hljs-type">String</span>) : <span class="hljs-type">String</span>

  <span class="hljs-comment">// get Todo items</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getTodos</span>(</span>) : <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>]

  <span class="hljs-comment">// update a Todo</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">updateTodo</span>(</span>item:<span class="hljs-type">TodoItem</span>)
}
</code></pre>
<p>Please check out uPickle documentation on what it can and cannot serialize. You might need to use something else if your data is complicated.
Case classes, base collections and basic data types are a safe bet.</p>
<p>So how does this work on the server side?</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./todo-module-and-data-flow.html" class="navigation navigation-prev " aria-label="Previous page: Todo module and data flow"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./server-side.html" class="navigation navigation-next " aria-label="Next page: Server side"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
